# General information about the players
players:
  number:
    min: 2
    max: 3

# Define card decks
card_decks:
  characters: character_cards.yaml
  buildings: building_cards.yaml

# selection ---> construction
#     ^              |
#     +--------------+ <is_ended>
#           no       | yes
#                    v
#                   fin
phases:
  selection:
    steps:
      - fn: reset_character_cards(state): state
      - fn: deck["characters"].reset_from_deck("characters")
      - fn: cards.shuffle()
      - fn: cards.remove(card_decks="characters", number=1)
      - for_each_player:
        - order_fn: character_selection_order()
        - fn: pick_random_card(characters)
      - go_to_phase: construction

  construction:
    steps:
      - for_each_player:
        - order_fn: construction_selection_order()
        - fn: do_turn()
      - cond:
        - if: construction_phase_over
          go_to_phase: end
        - go_to_phase: selection
  end: {}

# Define game play
# A turn will loop over players.
# A turn is finished whenever all players have played
game:
  - turns:  # Character selection
      setup_turn:  # done at the beginning of the turn
        actions:
          - shuffle_character_cards
      actions:  # done for each player in the turn
        - discard_character_card(1)
        - pick_random_character_card(1)
      resolve_turn: # done when all players played
        actions:
          - reset_character_cards
  - turns:  null # Building
